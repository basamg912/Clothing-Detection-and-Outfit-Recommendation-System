{% extends "base.html" %}
{% block title %}í™ˆ{% endblock %}

{% block content %}
<div class="page-header fade-in">
    <h1 class="page-title">ğŸ‘‹ ì˜ë¥˜ ë¶„ë¥˜ & ì½”ë”” ì¶”ì²œ</h1>
    <p class="page-subtitle">ì‚¬ì§„ì„ ì—…ë¡œë“œí•˜ë©´ AIê°€ ì˜ë¥˜ë¥¼ ë¶„ë¥˜í•˜ê³  ì½”ë””ë¥¼ ì¶”ì²œí•´ë“œë¦½ë‹ˆë‹¤</p>
</div>

<!-- Upload Zone -->
<form method="post" enctype="multipart/form-data" id="uploadForm" class="fade-in fade-in-delay-1">
    <div class="upload-zone" id="uploadZone">
        <input type="file" name="file" id="fileInput" required>
        <div class="upload-icon">ğŸ“¸</div>
        <div class="upload-title">ì‚¬ì§„ì„ ë“œë˜ê·¸ í•˜ê±°ë‚˜ í´ë¦­í•˜ì„¸ìš”</div>
        <div class="upload-sub">JPG, PNG íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì—¬ ì˜ë¥˜ë¥¼ ë¶„ë¥˜í•©ë‹ˆë‹¤</div>
    </div>
    <div style="margin-top: 16px; display: flex; gap: 12px; align-items: center;">
        <button class="btn-accent" type="submit" id="uploadBtn" style="display:none;">
            ğŸš€ ì—…ë¡œë“œ
        </button>
        <span id="fileName" style="color: var(--text-muted); font-size: 14px;"></span>
    </div>
</form>

<!-- Retry Warning -->
{% if show_retry %}
<div class="alert-modern fade-in" style="margin-top: 24px;">
    âš ï¸ ë¬¼ì²´ë¥¼ ì¸ì‹í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ê°ë„ì—ì„œ ì‚¬ì§„ì„ ë‹¤ì‹œ ì°ì–´ì£¼ì„¸ìš”.
</div>
{% endif %}

<!-- Success Redirect -->
{% if redirect_to %}
<script>
    document.addEventListener('DOMContentLoaded', () => {
        showToast('ì—…ë¡œë“œ ì„±ê³µ! ì˜ë¥˜ê°€ ë¶„ë¥˜ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        setTimeout(() => { window.location.href = "{{ url_for(redirect_to) }}"; }, 1200);
    });
</script>
{% endif %}

{% if corrected %}
<script>
    document.addEventListener('DOMContentLoaded', () => showToast('ìˆ˜ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success'));
</script>
{% endif %}

<!-- Quick Links -->
<div style="display: flex; gap: 12px; margin-top: 32px;" class="fade-in fade-in-delay-2">
    <a href="/closet" class="btn-ghost">ğŸ‘” ì˜·ì¥ ë³´ê¸°</a>
    <a href="/recommend" class="btn-ghost">âœ¨ ì½”ë”” ì¶”ì²œ</a>
</div>

{% if outfit %}
<div class="glass-card fade-in fade-in-delay-3" style="max-width: 420px; margin-top: 32px;">
    <div style="display: flex;">
        <div style="flex:1;">
            <img src="{{ url_for('static', filename='uploads/' + outfit.top) }}"
                style="width:100%; display:block; object-fit:cover;" alt="ì¶”ì²œ ìƒì˜">
        </div>
        <div style="flex:1;">
            <img src="{{ url_for('static', filename='uploads/' + outfit.bottom) }}"
                style="width:100%; display:block; object-fit:cover;" alt="ì¶”ì²œ í•˜ì˜">
        </div>
    </div>
    <div style="padding: 16px;">
        <h5 style="font-weight: 600; margin-bottom: 8px;">ì¶”ì²œ ì½”ë””</h5>
        <p style="color: var(--text-secondary); font-size: 14px;">
            ìƒì˜: {{ outfit.top }}<br>
            í•˜ì˜: {{ outfit.bottom }}
        </p>
    </div>
</div>
{% endif %}
{% endblock %}

{% block extra_scripts %}
<script>
    const zone = document.getElementById('uploadZone');
    const fileInput = document.getElementById('fileInput');
    const uploadBtn = document.getElementById('uploadBtn');
    const fileNameEl = document.getElementById('fileName');

    fileInput.addEventListener('change', () => {
        if (fileInput.files.length) {
            uploadBtn.style.display = 'inline-flex';
            fileNameEl.textContent = fileInput.files[0].name;
            zone.style.borderColor = 'var(--accent)';
        }
    });

    zone.addEventListener('dragover', (e) => {
        e.preventDefault();
        zone.classList.add('dragover');
    });
    zone.addEventListener('dragleave', () => zone.classList.remove('dragover'));
    zone.addEventListener('drop', (e) => {
        e.preventDefault();
        zone.classList.remove('dragover');
        fileInput.files = e.dataTransfer.files;
        fileInput.dispatchEvent(new Event('change'));
    });
</script>
{% endblock %}